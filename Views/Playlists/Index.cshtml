@model IEnumerable<SpotifyClone.Models.Playlist>

@{
    ViewData["Title"] = "Your Playlists";
}

<div class="container mx-auto">
    <h2 class="text-3xl font-bold mb-8">Your Playlists</h2>

    <a asp-action="Create" class="bg-green-500 hover:bg-green-400 text-white px-4 py-2 rounded mb-8 inline-block">Create New Playlist</a>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @foreach (var playlist in Model)
        {
            <div class="bg-gray-800 p-6 rounded-lg">
                <h5 class="text-xl font-semibold mb-2">@playlist.Name</h5>
                <p class="text-gray-300">@playlist.PlaylistSongs.Count songs</p>
                <div class="mt-4 space-x-2">
                    <a asp-action="Details" asp-route-id="@playlist.Id" class="bg-green-500 hover:bg-green-400 text-white px-4 py-2 rounded inline-block">View Playlist</a>
                    <button onclick="deletePlaylist(@playlist.Id, '@playlist.Name')" class="bg-red-500 hover:bg-red-400 text-white px-4 py-2 rounded inline-block">Delete</button>
                </div>
            </div>
        }
    </div>
</div>

<script>
    // Delete playlist with confirmation
    function deletePlaylist(playlistId, playlistName) {
        if (confirm(`Are you sure you want to delete the playlist "${playlistName}"? This action cannot be undone.`)) {
            fetch('/Playlists/Delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify(playlistId)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Playlist deleted successfully');
                    location.reload(); // Refresh to show updated playlist list
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while deleting the playlist');
            });
        }
    }
</script>